---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: infoblox-cni-daemon
  namespace: kube-system
spec:
  selector:
      matchLabels:
        name: infoblox-cni-daemon
  template:
    metadata:
      labels:
        name: infoblox-cni-daemon
    spec:
      terminationGracePeriodSeconds: 60
      hostNetwork: true
      containers:
      - image: infoblox/infoblox-cni-daemon
        name: infoblox-cni-daemon
        volumeMounts:
            - mountPath: /run/cni
              name: socket-dir
        imagePullPolicy: Always
        args:
          - "--grid-host=192.168.124.200"
          - "--wapi-port=443"
          - "--wapi-username=admin"
          - "--wapi-version=2.5"
          - "--socket-dir=/run/cni"
          - "--driver-name=infoblox"
          - "--k8s-cluster-name=k8s-cluster"
          - "--ssl-verify=false"
          - "--network-view=default"
          - "--network-container=192.168.0.0/24,192.169.0.0/24"
          - "--prefix-length=25"
        env:
          - name: WAPI_PASSWORD
            valueFrom:
              secretKeyRef:
                name: infoblox-secret
                key: wapi-password
      volumes:
        - name: socket-dir
          hostPath:
            path: /run/cni
---
apiVersion: v1
kind: Secret
metadata:
  name: infoblox-secret
  namespace: kube-system
type: Opaque
data:
  wapi-password: aW5mb2Jsb3g=
